FROM node:20-alpine AS base

WORKDIR /app

# Install deps (include dev deps because we run TS with tsx)
COPY package.json package-lock.json ./
RUN npm ci

# Copy source
COPY . .

# Runtime env
ENV NODE_ENV=production
EXPOSE 4000

# Start Fastify API (TypeScript via tsx)
CMD ["npx", "tsx", "server/index.ts"]

